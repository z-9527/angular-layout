<div>
  <i
    nz-icon
    nzType="setting"
    class="setting-icon"
    nz-popover
    [nzPopoverTitle]="header"
    [nzPopoverContent]="content"
    nzPopoverTrigger="click"
    nzPopoverBackdrop
    [nzPopoverOverlayClassName]="'table-setting-popover'"
    nzPopoverPlacement="bottomRight"
  ></i>
</div>

<ng-template #header>
  <div class="setting-header">
    <span>列展示</span>
    <button
      nz-button
      nzType="link"
      nzSize="small"
      [style.padding]="'0px'"
      (click)="onReset()"
    >
      重置
    </button>
  </div>
</ng-template>

<ng-template #content>
  <div class="content" cdkDropListGroup>
    <ng-container *ngFor="let item of config">
      <ng-container
        *ngTemplateOutlet="
          dropList;
          context: {
            title: item.title,
            list: getList(item.key),
            key: item.key
          }
        "
      ></ng-container>
    </ng-container>
  </div>
</ng-template>

<ng-template #dropList let-title="title" let-list="list" let-key="key">
  <div>
    <div class="title">{{ title }}</div>
    <div
      class="drag-list"
      cdkDropList
      [cdkDropListData]="list"
      (cdkDropListDropped)="drop($event)"
    >
      <div
        *ngFor="let item of list; let index = index"
        cdkDrag
        class="drag-list-item"
        [cdkDragDisabled]="!item.show"
      >
        <div class="item-custom-placeholder" *cdkDragPlaceholder></div>
        <i class="drag-icon" nz-icon [nzIconfont]="'icon-drag'"></i>
        <div>
          <label nz-checkbox [(ngModel)]="item.show" class="label">
            {{ item.title }}
          </label>
        </div>
        <div *ngIf="item.show">
          <ng-container *ngFor="let subItem of config">
            <i
              *ngIf="key !== subItem.key"
              [ngClass]="{
                'action-icon': true,
                'disabled-icon': getIconDisabled(subItem.key)
              }"
              nz-icon
              [nzType]="subItem.icon"
              nzTheme="outline"
              nz-tooltip
              [nzTooltipTitle]="
                getIconDisabled(subItem.key) ? '固定项已达上限' : subItem.title
              "
              nzTooltipPlacement="top"
              (click)="
                !getIconDisabled(subItem.key) &&
                  adjustPosition(index, key, subItem.key, item)
              "
            ></i>
          </ng-container>
        </div>
      </div>
    </div>
  </div>
</ng-template>
