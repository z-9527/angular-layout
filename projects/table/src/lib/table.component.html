<div [ngClass]="{ 'table-wrapper': true, fullscreen: fullscreen }">
  <!-- <div class="tip" *ngIf="_selectedRowKeys.size">
    已选 {{ _selectedRowKeys.size }} 项
  </div> -->

  <nz-table
    #basicTable
    [nzSize]="_size"
    [nzLoading]="_loading"
    [nzData]="_data"
    [nzScroll]="nzScroll"
    [nzBordered]="nzBordered"
    [nzOuterBordered]="nzOuterBordered"
    [nzTitle]="header"
    [nzFooter]="nzFooter"
    [nzNoResult]="nzNoResult"
    [nzShowPagination]="nzShowPagination"
    [nzFrontPagination]="!nzQueryList && nzFrontPagination"
    [nzTotal]="_total"
    [nzPageIndex]="nzPagination.pageIndex || 1"
    [nzPageSize]="nzPagination.pageSize || 10"
    [nzPageSizeOptions]="
      nzPagination.pageSizeOptions || [5, 10, 20, 30, 40, 50]
    "
    [nzShowQuickJumper]="nzPagination.showQuickJumper !== false"
    [nzShowSizeChanger]="nzPagination.showSizeChanger !== false"
    [nzShowTotal]="totalTemplate"
    [nzPaginationType]="_size"
    (nzPageIndexChange)="pageIndexChange($event)"
    (nzPageSizeChange)="pageSizeChange($event)"
    (nzCurrentPageDataChange)="currentPageDataChange($event)"
    (nzQueryParams)="onQueryParams($event)"
  >
    <thead>
      <tr>
        <ng-container *ngIf="nzShowRowSelection">
          <th
            [width]="'50px'"
            [nzLeft]="nzRowSelection.fixed !== false"
            [nzChecked]="checked"
            [nzIndeterminate]="indeterminate"
            (nzCheckedChange)="onAllChecked($event)"
          ></th>
        </ng-container>

        <ng-container *ngFor="let column of _columns">
          <th
            *ngIf="column.show"
            [nzRight]="column.fixed === 'right'"
            [nzLeft]="column.fixed === 'left'"
            [nzAlign]="column.align"
            [nzShowSort]="column.showSort"
            [nzSortFn]="column.sortFn"
            [nzSortDirections]="column.sortDirections"
            [nzSortOrder]="column.nzSortOrder"
            [nzSortOrderChange]="column.sortOrderChange"
            [nzShowFilter]="column.showFilter"
            [nzFilterFn]="column.filterFn"
            [nzFilters]="column.filters"
            [nzFilterMultiple]="column.nzFilterMultiple"
            [nzFilterChange]="column.nzFilterChange"
            [nzColumnKey]="column.dataIndex"
          >
            <ng-container
              *nzStringTemplateOutlet="
                nzTemplateRefs[column.titleRef] ||
                column.titleRef ||
                column.title
              "
            >
              {{ column.title }}
            </ng-container>
          </th>
        </ng-container>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let data of basicTable.data; let i = index">
        <ng-container *ngIf="nzShowRowSelection">
          <td
            [nzLeft]="nzRowSelection.fixed !== false"
            [nzChecked]="_selectedRowKeys.has(getRowKeyValue(data))"
            [nzDisabled]="data.disabled"
            (nzCheckedChange)="
              onItemChecked(getRowKeyValue(data), $event, data)
            "
          ></td>
        </ng-container>
        <ng-container *ngFor="let item of _columns">
          <td
            *ngIf="item.show"
            [class]="item.className"
            [nzRight]="item.fixed === 'right'"
            [nzLeft]="item.fixed === 'left'"
            [nzAlign]="item.align"
          >
            <ng-container
              *ngTemplateOutlet="
                td;
                context: {
                  column: item,
                  data: data,
                  index: i,
                  text: item.format
                    ? item.format(data[item.dataIndex], data, i)
                    : data[item.dataIndex]
                }
              "
            ></ng-container>
          </td>
        </ng-container>
      </tr>
    </tbody>
  </nz-table>
</div>

<ng-template #header>
  <div class="header-box">
    <ng-container *nzStringTemplateOutlet="nzTitle">
      <div class="title">{{ nzTitle }}</div>
    </ng-container>
    <div class="header-right">
      <ng-container *nzStringTemplateOutlet="nzHeader">
        {{ nzHeader }}
      </ng-container>
      <lib-tooltip
        [nzColumns]="_columns"
        [initColumns]="_initColumns"
        (changeSize)="changeSize($event)"
        (toggleFullScreen)="toggleFullScreen($event)"
        (refresh)="refresh()"
        (changeColumns)="changeColumns($event)"
      ></lib-tooltip>
    </div>
  </div>
</ng-template>

<ng-template
  #td
  let-data="data"
  let-text="text"
  let-index="index"
  let-column="column"
>
  <ng-container
    *nzStringTemplateOutlet="
      nzTemplateRefs[column.ref];
      context: {
        record: data,
        $implicit: data,
        index: index,
        text: text
      }
    "
  >
    <div
      class="table-ellipsis"
      [style.width]="column.width"
      nz-tooltip
      [nzTooltipTitle]="text"
    >
      {{ text }}
    </div>
  </ng-container>
</ng-template>

<ng-template #totalTemplate let-total> 共 {{ total }} 条</ng-template>
