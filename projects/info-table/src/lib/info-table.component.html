<div class="info-table-wrap">
  <div class="info-table-title" *ngIf="title">
    <ng-container *nzStringTemplateOutlet="title">
      {{ title }}
    </ng-container>
  </div>
  <div>
    <ng-container *ngIf="isArray(config)">
      <ng-container *ngFor="let row of config">
        <div class="info-table-row">
          <ng-container *ngIf="isArray(row)">
            <ng-container *ngFor="let field of row">
              <div
                class="info-table-field"
                *ngIf="
                  field.hideExpression ? !field.hideExpression(data) : true
                "
              >
                <div class="field-label" [style.width]="labelWidth">
                  {{ field.label }}
                </div>
                <div class="field-value">
                  <ng-container
                    *ngTemplateOutlet="
                      fieldRef;
                      context: {
                        ref: templateRefs[field.ref] || field.ref,
                        text: getText(data, field),
                        link: getLink(data, field),
                        field: field,
                        data: data
                      }
                    "
                  >
                  </ng-container>
                </div>
              </div>
            </ng-container>
          </ng-container>
        </div>
      </ng-container>
    </ng-container>
  </div>
</div>

<ng-template
  #fieldRef
  let-ref="ref"
  let-text="text"
  let-field="field"
  let-data="data"
  let-link="link"
>
  <ng-container
    *nzStringTemplateOutlet="
      ref;
      context: {
        data: data,
        text: text,
        key: field.key,
        link: link,
        field: field
      }
    "
  >
    <ng-container *ngIf="field.ellipsis === false; else elseRef">
      <ng-container *ngTemplateOutlet="textRef"></ng-container>
    </ng-container>
    <ng-template #elseRef>
      <lib-ellipsis-text>
        <ng-container *ngTemplateOutlet="textRef"></ng-container>
      </lib-ellipsis-text>
    </ng-template>

    <ng-template #textRef>
      <a *ngIf="field.type === 'link'" [href]="link" target="_blank">{{
        text
      }}</a>
      <ng-container *ngIf="field.type !== 'link'">{{ text }}</ng-container>
    </ng-template>
  </ng-container>
</ng-template>
